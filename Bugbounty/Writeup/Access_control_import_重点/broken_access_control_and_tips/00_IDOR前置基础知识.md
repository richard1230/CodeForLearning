https://www.bugcrowd.com/resources/levelup/hunting-id-substitution-attacks-for-big-dollars-with-z-wink/


一般来说，正确的授权和访问需要（3）步骤：<br>

是否存在有效的身份验证令牌/cookie？（粗略翻译，是用户登录）<br>
如果不是，则返回拒绝访问 401/403 错误。<br>
如果 auth 存在并且有效，那么用户是否具有正确的角色/范围？（粗略翻译，用户是否可以使用此功能）<br>
如果不是，则返回拒绝访问 401/403 错误。 <br>
如果使用适当的角色进行身份验证，用户是否有权访问请求的ID？（粗略翻译，经过身份验证的用户 ID 是否可以访问请求的 ID）<br>
如果不是，则返回拒绝访问 401/403 错误。<br>

缺少上述第三项检查通常是导致此安全漏洞的原因。服务器检查用户 A是否已通过身份验证，并且用户 A具有请求类型的正确角色/范围，但不检查用户 A 是否有权访问所请求的 ID。有时，根据架构，进行这种额外检查对开发人员来说是一种负担，这就是它在野外如此普遍的原因。 <br>




先决条件：<br>

为了使目标容易受到 ID 替换攻击，目标需要使用可以用其他有效值替换的 ID。ID 可以采用多种形式，但通常是字母数字和可迭代的。特定 ID 表示的对象越多（例如：数百万个帐户与 100 个帐户），该 ID 就越有可能被另一个 ID 轻松替换并获得。此外，更多的受害者通常等同于更高的影响。<br>

要安全地检查 ID 替换问题 (IDOR)，您需要目标上的两个帐户。目标是通过简单地替换ID来尝试从第一个帐户获取第二个帐户的 ID/对象。因此，您将作为帐户#1 进行身份验证，并使用帐户#1 中的cookies/auth 令牌尝试访问帐户#2 中的ID。如果这可行，通常它代表严重的 PII 数据泄漏/破坏风险，或对系统的完整性影响。关于这些漏洞最好的部分是，每个漏洞通常都是一个单独的问题，不共享一个根本原因修复，因为损坏的访问控制通常是每个请求的问题。<br>

强烈建议您手动测试这些，而不是自动化，因为自动化错过了很多。我最近才发现其中一个问题会为数百万用户转储信用卡信息，而机器人会错过它！<br>



组织：

在测试这些问题时，组织是关键。将两组凭据保存在记事本或某个易于访问的位置的剪贴板上，以便轻松替换您找到的 ID。<br>

Account1@place.com <br>
姓名：鲍勃·史密斯 <br>

用户名：111111 <br>

简介ID：54321 <br>

商号：XHGFY123 <br>

授权饼干 1 <br>

Account2@place.com <br>
姓名：蒂娜·特纳 <br>

用户名：222222 <br>

简介ID：12345 <br>

商号：YTNFK432 <br>

授权饼干 2 <br>



有了这个组织，现在可以非常简单地以账户 1 登录，并且在任何您看到 ID 实例“111111”、“54321”或“XHGFY123”的地方 - 尝试使用来自账户 2 的信息更改 ID，看看会发生什么. 您是否通过 GET 请求取回帐户 2 的信息？账户 2 的信息是否因 *PUT/POST/PATCH/DELETE 请求而更改？如果是这样，您将获得免费资金，让世界变得更安全！万岁你！*请记住，在测试 ID 替换问题的 PUT/PATCH/POST/DELETE 请求时，您可能会对帐户的完整性产生严重影响，因此请始终使用您拥有的第二个帐户进行测试，或向程序寻求帮助。GET 请求一般是 <br>

从完整性的角度来看是无害的，但并非总是如此——所以要小心。这是我不建议使用自动化测试这些的另一个原因。 <br>



测试方法：<br>

登录到帐户 1，然后单击您可能找到的所有内容。这意味着填写所有功能的信息。我的意思是所有功能。例如，如果您因为不想输入有效的信用卡号而跳过某个功能，那么您可能会丢失 2 到 20 个不同的 API 调用和您可以测试的第 3 方交互。这就是我最近发现大量信用卡泄漏的原因，我猜其他黑客都没有进入信用卡。说真的，按下所有按钮，尽你所能找到尽可能多的请求。 <br>
在第 1 步之后，检查所有请求并将所有 ID 替换为帐户 #2，看看会发生什么。   <br>
现在，发挥创意，开始寻找软件没有积极使用的隐藏 URL。这些可以在 JS 文件中，在搜索引擎中找到，回溯引擎（网站的历史版本），通过暴力破解或对单词列表进行模糊测试，等等。冲洗并重复。  <br>
大脑训练：  <br>

训练您的大脑在 URL 和参数（包括 URI 和有效负载主体）中发现这些。这就是它的全部。<br>

示例： api.website.com/admin/users/ 123456789000 /creditData/?payment=USD&place=US * 类似这样的请求仅返回任何用户 ID 的 CC 数据。哎呀！ <br>